{% extends "base.html" %}

{% block extra_css %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/validar_aprendices.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/modal.css') }}">
{% endblock %}

{% block content %}
<div class="instructor-panel">
  <h2><i class="fas fa-user-check"></i> Validar Aprendices</h2>
  <div class="table-container">
    <table class="instructor-table">
      <thead>
        <tr>
          <th><i class="fas fa-user"></i> Nombre</th>
          <th><i class="fas fa-id-card"></i> Documento</th>
          <th><i class="fas fa-envelope"></i> Email</th>
          <th><i class="fas fa-file-alt"></i> Ficha</th>
          <th><i class="fas fa-calendar-alt"></i> Fecha de Registro</th>
          <th><i class="fas fa-cogs"></i> Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for aprendiz in aprendices %}
        <tr>
          <td>{{ aprendiz.nombre }}</td>
          <td>{{ aprendiz.documento }}</td>
          <td>{{ aprendiz.email }}</td>
          <td>{{ aprendiz.ficha.nombre }}</td>
          <td>{{ aprendiz.fecha_registro.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>
            <div class="botones-container">
              <form action="{{ url_for('instructor.validar_aprendiz', id_usuario=aprendiz.id_usuario, accion='aprobar') }}" method="POST" onsubmit="event.preventDefault(); confirmarAccionAprobar(this);">
                <button type="submit" class="btn btn-primary"><i class="fas fa-check"></i> Aprobar</button>
              </form>
              <form action="{{ url_for('instructor.validar_aprendiz', id_usuario=aprendiz.id_usuario, accion='rechazar') }}" method="POST" onsubmit="event.preventDefault(); confirmarAccionRechazar(this);">
                <button type="submit" class="btn btn-secondary"><i class="fas fa-times"></i> Rechazar</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  {% if not aprendices or aprendices|length == 0 %}
    <div class="empty-state">
      <i class="fas fa-user-graduate"></i>
      <p>No hay aprendices pendientes de validación en tus fichas.</p>
    </div>
  {% endif %}
</div>

<!-- Modal para mensaje de no fichas asignadas -->
{% with messages = get_flashed_messages() %}
<div id="noFichasModal" class="modal-overlay" data-show="{{ 'true' if 'No tienes fichas asignadas como instructor líder' in messages else 'false' }}">
  <div class="modal-container">
    <div class="modal-header">
      <i class="fas fa-exclamation-circle"></i>
      <h3>Aviso</h3>
    </div>
    <div class="modal-body">
      No tienes fichas asignadas como instructor líder.
    </div>
    <div class="modal-footer">
      <button class="modal-btn" data-url="{{ url_for('instructor.instructor_dashboard') }}">
        <i class="fas fa-home"></i> Volver al Inicio
      </button>
    </div>
  </div>
</div>
{% endwith %}
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/instructor/validar_aprendices.js') }}"></script>
<script>
function confirmarAccionAprobar(form) {
  QuickExitNotifications.show({
    type: 'warning',
    title: 'Primera Confirmación',
    message: '¿Está seguro de aprobar a este aprendiz?',
    duration: 0,
    dismissible: true,
    actions: [
      {
        text: 'Cancelar',
        type: 'secondary',
        icon: 'fas fa-times',
        callback: () => {}
      },
      {
        text: 'Continuar',
        type: 'primary',
        icon: 'fas fa-arrow-right',
        callback: () => {
          QuickExitNotifications.show({
            type: 'success',
            title: 'Confirmación Final',
            message: '¿Realmente desea aprobar a este aprendiz?',
            duration: 0,
            dismissible: true,
            actions: [
              {
                text: 'Cancelar',
                type: 'secondary',
                icon: 'fas fa-times',
                callback: () => {}
              },
              {
                text: 'Aprobar',
                type: 'primary',
                icon: 'fas fa-check',
                callback: () => { form.submit(); }
              }
            ]
          });
        }
      }
    ]
  });
}
function confirmarAccionRechazar(form) {
  QuickExitNotifications.show({
    type: 'warning',
    title: 'Primera Confirmación',
    message: '¿Está seguro de rechazar a este aprendiz? Esta acción no se puede deshacer.',
    duration: 0,
    dismissible: true,
    actions: [
      {
        text: 'Cancelar',
        type: 'secondary',
        icon: 'fas fa-times',
        callback: () => {}
      },
      {
        text: 'Continuar',
        type: 'primary',
        icon: 'fas fa-arrow-right',
        callback: () => {
          QuickExitNotifications.show({
            type: 'danger',
            title: 'Confirmación Final',
            message: '¿Realmente desea rechazar a este aprendiz? Esta acción no se puede deshacer.',
            duration: 0,
            dismissible: true,
            actions: [
              {
                text: 'Cancelar',
                type: 'secondary',
                icon: 'fas fa-times',
                callback: () => {}
              },
              {
                text: 'Rechazar',
                type: 'primary',
                icon: 'fas fa-times',
                callback: () => { form.submit(); }
              }
            ]
          });
        }
      }
    ]
  });
}
</script>
{% endblock %} 