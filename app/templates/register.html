{% extends "base.html" %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/global/register.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}

{% block content %}
<div class="register-container">
  <h2><i class="fas fa-user-plus"></i> Regístrate</h2>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% set allowed_register_messages = [
          'Solo se permite el registro de aprendices. Si eres instructor o portero, contacta al área administrativa.',
          'Todos los campos son obligatorios',
          'Ficha seleccionada no válida.',
          'Esta ficha no tiene un instructor líder asignado. Contacte al administrador.',
          'Usuario ya registrado con este email o documento',
          'Registro exitoso. Inicia sesión.',
          'Registro exitoso. Tu cuenta está pendiente de validación por el instructor líder de tu ficha.'
      ] %}
      {% for category, message in messages %}
        {% if message in allowed_register_messages and category in ['danger', 'warning', 'info', 'success'] %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endwith %}
  <form method="POST" class="register-form">
    <div class="input-group">
      <span class="input-icon"><i class="fas fa-id-card"></i></span>
      <input type="text" id="documento" name="documento" required pattern="[0-9]+" inputmode="numeric" placeholder="Documento (DNI/Cédula)" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
    </div>
    <div class="input-group">
      <span class="input-icon"><i class="fas fa-user"></i></span>
      <input type="text" id="nombre" name="nombre" required placeholder="Nombre">
    </div>
    <div class="input-group">
      <span class="input-icon"><i class="fas fa-envelope"></i></span>
      <input type="email" id="email" name="email" required placeholder="Email">
    </div>
    <div class="input-group">
      <span class="input-icon"><i class="fas fa-lock"></i></span>
      <input type="password" id="password" name="password" required placeholder="Contraseña">
    </div>
    <input type="hidden" id="rol" name="rol" value="aprendiz">
    <div class="input-group">
      <span class="input-icon"><i class="fas fa-graduation-cap"></i></span>
      <select id="id_ficha" name="id_ficha" required>
        <option value="" disabled selected>Selecciona tu ficha</option>
        {% for ficha in fichas %}
          <option value="{{ ficha.id_ficha }}">{{ ficha.id_ficha }} - {{ ficha.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Registrarse <i class="fas fa-arrow-right"></i></button>
  </form>
  <p>¿Ya tienes una cuenta? <a href="{{ url_for('main.login') }}">Inicia sesión aquí</a></p>
</div>
{% endblock %}

{% block extra_js %}
<!-- Cargamos el JS que controla la visibilidad del campo "ficha" -->
<script src="{{ url_for('static', filename='js/register.js') }}"></script>
{% endblock %}
