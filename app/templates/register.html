{% extends "base.html" %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/global/register.css') }}">
{% endblock %}

{% block content %}
<div class="register-container">
  <h2>Regístrate</h2>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  <form method="POST" class="register-form">
    <div class="form-group">
      <label for="documento">Documento (DNI/Cédula):</label>
      <input type="text" id="documento" name="documento" required pattern="[0-9]+" inputmode="numeric" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
    </div>

    <div class="form-group">
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" name="nombre" required>
    </div>

    <div class="form-group">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
    </div>

    <div class="form-group">
      <label for="password">Contraseña:</label>
      <input type="password" id="password" name="password" required>
    </div>

    <input type="hidden" id="rol" name="rol" value="aprendiz">

    <!-- Campo de Ficha (solo para aprendices) -->
    <div class="form-group" id="ficha-container">
      <label for="id_ficha">Selecciona tu Ficha:</label>
      <select id="id_ficha" name="id_ficha">
        {% for ficha in fichas %}
          <option value="{{ ficha.id_ficha }}">{{ ficha.id_ficha }} - {{ ficha.nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <button type="submit" class="btn">Registrarse</button>
  </form>

  <p>¿Ya tienes una cuenta? <a href="{{ url_for('main.login') }}">Inicia sesión aquí</a></p>
</div>
{% endblock %}

{% block extra_js %}
<!-- Cargamos el JS que controla la visibilidad del campo "ficha" -->
<script src="{{ url_for('static', filename='js/register.js') }}"></script>
<script>
// Validación extra por JS para evitar letras en el input documento
const docInput = document.getElementById('documento');
docInput.addEventListener('input', function(e) {
  this.value = this.value.replace(/[^0-9]/g, '');
});
</script>
{% endblock %}
